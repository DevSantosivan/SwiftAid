<div class="content-body">
  <div class="content_1">
    <h4>Resident Account Management</h4>
    <p>List of resident accounts</p>

    <!-- Search Bar -->
    <div class="search-bar">
      <input
        type="text"
        placeholder="Search resident accounts..."
        [(ngModel)]="searchTerm"
      />
      <button type="button">
        <i class="bx bx-search"></i>
      </button>
    </div>

    <!-- Accounts Summary -->
    <div class="orders-summary">
      <div class="order-card total-orders">
        <h3>Total Account This Month</h3>
        <p class="order-count">{{ totalResidentAccountsCount }}</p>
      </div>
      <div class="order-card pending-orders">
        <h3>Pending Account</h3>
        <p class="order-count">{{ pendingResidentAccountsCount }}</p>
      </div>
      <div class="order-card shipped-orders">
        <h3>Registered Account</h3>
        <p class="order-count">{{ registeredResidentAccountsCount }}</p>
      </div>
      <div class="order-card refunded-orders">
        <h3>Blocked Account</h3>
        <p class="order-count">{{ blockedResidentAccountsCount }}</p>
      </div>
    </div>

    <!-- Resident Account List -->
    <div>
      <h3>Account list</h3>
      <br />
      <div class="account-header">
        <span class="col-name">Profile</span>
        <span class="col-name">Name</span>
        <span class="col-email">Email</span>
        <span class="col-contact">Contact</span>
        <span class="col-extra">Address</span>
        <span class="col-extra">Status</span>
        <span class="col-extra">Account Status</span>
        <span class="col-extra">Created At</span>
        <span class="col-action"></span>
      </div>

      <div class="account-list">
        <div class="account-row" *ngFor="let acc of paginatedResidents">
          <span class="col-name">
            <img
              class="profile-img-list"
              [src]="acc.profileImageUrl || defaultAvatar"
              alt="{{ acc.fullName }}"
            />
          </span>
          <span class="col-name">{{ acc.fullName }}</span>
          <span class="col-email">{{ acc.email }}</span>
          <span class="col-contact">{{ acc.contactNumber }}</span>
          <span class="col-extra">{{ acc.address }}</span>
          <span class="col-extra" [style.color]="acc.blocked ? 'red' : 'green'">
            {{ acc.blocked ? "Blocked" : "Registered" }}
          </span>
          <span class="col-extra">{{ acc.account_status }}</span>
          <span class="col-extra">{{
            acc.createdAt | date : "mediumDate"
          }}</span>
          <span class="col-action action-buttons">
            <button title="View" (click)="viewAccount(acc)">
              <i class="bx bx-show"></i>
            </button>
            <button title="Edit" (click)="editAccount(acc)">
              <i class="bx bx-edit"></i>
            </button>
            <button title="Delete" (click)="deleteAccount(acc)">
              <i class="bx bx-trash"></i>
            </button>
          </span>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="totalPages > 1">
        <span>
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} -
          {{ Math.min(currentPage * itemsPerPage, filteredResidents.length) }}
          of {{ filteredResidents.length }} entries
        </span>

        <ul class="pagination">
          <li
            [class.disabled]="currentPage === 1"
            (click)="goToPage(currentPage - 1)"
          >
            &laquo; Previous
          </li>
          <li
            *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1"
            (click)="goToPage(i + 1)"
          >
            {{ i + 1 }}
          </li>
          <li
            [class.disabled]="currentPage === totalPages"
            (click)="goToPage(currentPage + 1)"
          >
            Next &raquo;
          </li>
        </ul>
      </div>

      <!-- No Data -->
      <div *ngIf="filteredResidents.length === 0" class="no-data">
        <img src="../../../assets/Empty Box.gif" alt="No Residents" />
        <p>No resident accounts found.</p>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div class="modal-edit-overlay" *ngIf="accountToView && !accountToEdit">
    <div class="modal-card">
      <header class="modal-header">
        <h2 class="modal-title">Account Details</h2>
        <button class="close-btn" (click)="closeView()">√ó</button>
      </header>

      <div class="modal-body">
        <div class="profile-side">
          <img
            class="profile-pic"
            [src]="accountToView.profileImageUrl || defaultAvatar"
            alt="{{ accountToView.fullName }}'s Profile Picture"
          />
        </div>

        <div class="details-side">
          <h3>{{ accountToView.fullName }}</h3>
          <p><strong>Role:</strong> {{ accountToView.role | titlecase }}</p>
          <p>
            <strong>Status:</strong>
            <span [style.color]="accountToView.blocked ? 'red' : 'green'">
              {{ accountToView.blocked ? "Blocked" : "Registered" }}
            </span>
          </p>

          <div class="form-actions" style="margin-top: 20px">
            <button
              *ngIf="!accountToView.blocked"
              class="block-btn"
              (click)="openBlockModal(accountToView)"
            >
              <i class="bx bx-block"></i> Block Account
            </button>

            <button
              *ngIf="accountToView.blocked"
              class="unblock-btn"
              (click)="openUnblockModal(accountToView)"
            >
              <i class="bx bx-block"></i> Unblock Account
            </button>
          </div>

          <section>
            <h4>Contact Information</h4>
            <p><strong>Phone:</strong> {{ accountToView.contactNumber }}</p>
            <p><strong>Email:</strong> {{ accountToView.email }}</p>
            <p><strong>Address:</strong> {{ accountToView.address }}</p>
          </section>

          <section *ngIf="accountToView.validIdImageUrl">
            <h4>Valid ID</h4>
            <a
              [href]="accountToView.validIdImageUrl"
              target="_blank"
              rel="noopener noreferrer"
              class="valid-id-wrapper"
            >
              <img
                [src]="accountToView.validIdImageUrl"
                alt="Valid ID"
                class="valid-id-img"
              />
              <span class="hover-text">View Full Image</span>
            </a>
          </section>

          <section>
            <h4>Verification Information</h4>
            <p><strong>ID Number:</strong> {{ accountToView.idNumber }}</p>
            <p>
              <strong>Date of Birth:</strong>
              {{ accountToView.dateOfBirth | date : "yyyy-MM-dd" }}
            </p>
            <p><strong>Gender:</strong> {{ accountToView.sex }}</p>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal-edit-overlay" *ngIf="accountToEdit">
    <div class="modal-card">
      <header class="modal-header">
        <h2 class="modal-title">Edit Profile</h2>
        <button class="close-btn" (click)="closeEdit()">√ó</button>
      </header>

      <div class="modal-body">
        <div class="profile-side">
          <img
            [src]="accountToEdit.profileImageUrl || defaultAvatar"
            alt="Profile Picture"
            class="profile-pic"
          />
          <button class="edit-pic-btn" (click)="triggerProfileImageUpload()">
            <i class="bx bx-edit-alt"></i> Edit
          </button>
          <input
            type="file"
            id="profileImageInput"
            (change)="onAvatarChange($event)"
            hidden
          />
        </div>

        <form [formGroup]="editForm" class="form-side" novalidate>
          <div class="form-row">
            <label for="fullName">Full Name</label>
            <input id="fullName" type="text" formControlName="fullName" />
          </div>
          <div class="form-row">
            <label for="email">Email</label>
            <input id="email" type="email" formControlName="email" />
          </div>
          <div class="form-row">
            <label for="contactNumber">Contact Number</label>
            <input
              id="contactNumber"
              type="tel"
              formControlName="contactNumber"
            />
          </div>
          <div class="form-row">
            <label for="address">Address</label>
            <input id="address" type="text" formControlName="address" />
          </div>
          <div class="form-row">
            <label for="sex">Gender</label>
            <select id="sex" formControlName="sex">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="form-row">
            <label for="dateOfBirth">Birthday</label>
            <input id="dateOfBirth" type="date" formControlName="dateOfBirth" />
          </div>
          <div class="form-row">
            <label for="idNumber">Valid ID Number</label>
            <input id="idNumber" type="text" formControlName="idNumber" />
          </div>

          <div class="form-actions">
            <button class="save-btn" type="button" (click)="saveEdit()">
              Save
            </button>
            <button class="cancel-btn" type="button" (click)="closeEdit()">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="block-modal-backdrop" *ngIf="showDeleteModal">
    <div class="modal block-modal">
      <h3>üóëÔ∏è Confirm Delete</h3>
      <div class="member-card">
        <div class="member-info-row">
          <span>
            Are you sure you want to delete
            <strong>{{ accountToDelete?.fullName }}?</strong>
          </span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="confirm-btn" (click)="confirmDelete()">Yes</button>
        <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Block Modal -->
  <div class="block-modal-backdrop" *ngIf="showBlockModal">
    <div class="modal block-modal">
      <h3>Block Account</h3>
      <p class="warning">‚ö† Are you sure you want to block this account?</p>

      <div class="form-row">
        <label for="blockReason">Reason for Blocking</label>
        <select
          id="blockReason"
          [(ngModel)]="blockReason"
          name="blockReason"
          class="block-reason-dropdown"
        >
          <option value="" disabled selected>Select reason...</option>
          <option value="Inactive account">Inactive account</option>
          <option value="Misuse of Emergency System">
            Misuse of Emergency System
          </option>
          <option value="Submitting False Emergency Reports">
            Submitting False Emergency Reports
          </option>
          <option value="Violation of Community Guidelines">
            Violation of Community Guidelines
          </option>
          <option value="Duplicate Account">Duplicate Account</option>
          <option value="Suspicious Activity Detected">
            Suspicious Activity Detected
          </option>
          <option value="Unauthorized Access Attempt">
            Unauthorized Access Attempt
          </option>
          <option value="Spamming Emergency Requests">
            Spamming Emergency Requests
          </option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="form-row" *ngIf="blockReason === 'Other'">
        <label for="otherReason">Specify Reason</label>
        <textarea
          id="otherReason"
          [(ngModel)]="otherBlockReason"
          placeholder="Enter custom reason..."
        ></textarea>
      </div>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeBlockModal()">Cancel</button>
        <button class="confirm-btn" (click)="confirmBlock()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Unblock Modal -->
  <div class="unblock-modal-backdrop" *ngIf="showUnblockModal">
    <div class="modal unblock-modal">
      <h3>Unblock Account</h3>
      <p class="warning">
        ‚ö† Are you sure you want to unblock
        <strong>{{ accountToUnblock?.fullName }}</strong
        >?
      </p>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeUnblockModal()">Cancel</button>
        <button class="confirm-btn" (click)="confirmUnblock()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Loading Modal -->
  <div class="loading-modal-backdrop" *ngIf="blockingInProgress">
    <div class="loading-modal-content">
      <div class="spinner"></div>
      <div>Processing, please wait...</div>
    </div>
  </div>
</div>

<div class="content-body">
  <h3>Staff Reports</h3>
  <p>Reports generated by administrators</p>

  <!-- Loading Overlay -->
  <div class="loading-modal-backdrop" *ngIf="loading">
    <div class="loading-modal-content">
      <div class="spinner"></div>
      <div>Processing, please wait...</div>
    </div>
  </div>

  <!-- Month Filter -->
  <div class="month-filter">
    <div class="filter-row">
      <!-- LEFT: Month -->
      <div class="month-section">
        <label>Filter by Month:</label>
        <div class="month-buttons">
          <button
            *ngFor="let m of months"
            [class.active]="selectedMonth === m.value"
            (click)="selectMonth(m.value)"
          >
            {{ m.name }}
          </button>
          <button
            [class.active]="selectedMonth === undefined"
            (click)="selectMonth(undefined)"
          >
            All
          </button>
        </div>
      </div>

      <!-- RIGHT: Year -->
      <div class="year-section">
        <label>Filter by Year:</label>
        <select [(ngModel)]="selectedYear" (change)="applyFilters()">
          <option [ngValue]="undefined">All</option>
          <option *ngFor="let y of years" [ngValue]="y">{{ y }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <input
      type="text"
      placeholder="Search"
      [(ngModel)]="searchTerm"
      (input)="applyFilters()"
    />
    <button class="refresh-btn" (click)="fetchReports()">Refresh</button>
  </div>

  <!-- No Reports Placeholder -->
  <ng-container *ngIf="filteredReports.length === 0 && !loading">
    <div class="no-data">
      <img src="assets/Empty Box.gif" alt="No Data" />
      <p>No reports available.</p>
    </div>
  </ng-container>

  <!-- Summarized Reports Cards -->

  <div class="report-cards" *ngIf="filteredReports.length > 0">
    <div *ngFor="let report of filteredReports" class="report-card">
      <div class="report-summary">
        <strong>{{ report.generatedBy.fullName || 'Unknown Admin' }}</strong>
        generated a report on
        <strong>{{ report.generatedAt?.toDate() | date:'mediumDate' }}</strong>.
        During this period, there were
        <strong>{{ report.totalRequests }}</strong> requests
        <span class="resolved">{{ report.resolvedCount }} resolved</span>

        <span class="report-description"
          >Activity summary for the selected period.</span
        >
      </div>

      <div class="report-actions">
        <button class="view-btn" (click)="viewReport(report)">
          <i class="bx bxs-file-doc"></i> Download Report
        </button>
      </div>
    </div>
  </div>

  <!-- Modal for Detailed Requests -->
  <div class="report-view-modal" *ngIf="reportToView">
    <div class="modal-backdrop" (click)="closeView()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Requests in Report</h3>
        <button class="close-btn" (click)="closeView()">Ã—</button>
      </div>
      <div class="modal-body">
        <div *ngFor="let req of reportRequests" class="request-card">
          <div class="request-header">
            <div class="user-info">
              <img [src]="req.profilePicture || defaultAvatar" alt="User" />
              <div class="user-details">
                <h5>{{ req.name || "Unknown User" }}</h5>
                <p>
                  <i class="bx bxs-phone"></i> {{ req.contactNumber || "-" }}
                </p>
              </div>
            </div>
            <span
              class="status-badge"
              [ngClass]="{
                resolved: req.status.toLowerCase() === 'resolved' || req.status.toLowerCase() === 'completed',
              
              }"
            >
              {{ req.status | titlecase }}
            </span>
          </div>

          <div class="request-body">
            <p>
              <i class="bx bx-time"></i> {{ req.timestamp?.toDate() |
              date:'medium' }}
            </p>
            <p><i class="bx bxs-location-plus"></i> {{ req.address || "-" }}</p>
            <p><strong>Event:</strong> {{ req.event || "-" }}</p>
            <p><strong>Accepted By:</strong> {{ req.staffFullName || "-" }}</p>
          </div>
        </div>

        <ng-container *ngIf="reportRequests.length === 0">
          <p>No requests included in this report.</p>
        </ng-container>
      </div>
    </div>
  </div>
</div>

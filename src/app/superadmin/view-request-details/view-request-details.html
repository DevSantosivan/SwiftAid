<p>view-request-details works!</p>
<div class="content-body">
  <div class="content_1">
    <div (click)="navigateBackToList()" class="content-header">
      <i style="font-size: 25px" class="bx bx-left-arrow-alt"></i>
      <span
        >Back to {{ fromPage === 'incident' ? 'Incident History' : 'Emergency
        Requests' }}</span
      >
    </div>

    <br />
    <h4 style="font-size: 15px">Emergency Response Panel</h4>
    <p>Details for Emergency Request Review</p>

    <div *ngIf="request" class="request-details-container">
      <!-- LEFT PANEL: Reporter Info -->

      <div class="left-panel">
        <!-- Emergency ID -->
        <h4>
          <i class="bx bx-error-circle"></i>
          Emergency ID #{{ request.id }}
        </h4>

        <!-- USER DETAILS SECTION -->
        <div class="section-title">User Details</div>

        <!-- Profile Section -->
        <div class="caller-info">
          <img
            [src]="request.profilePicture || 'https://i.pinimg.com/736x/32/e4/61/32e46132a367eb48bb0c9e5d5b659c88.jpg'"
            alt="Profile Picture"
            class="caller-photo"
          />
          <div>
            <h5>{{ request.name }}</h5>
            <p class="subtext">Submitted by Resident</p>
          </div>
        </div>

        <!-- Contact -->
        <div class="form-group row">
          <label><i class="bx bx-phone"></i> Contact Number</label>
          <p class="readonly-text">{{ request.contactNumber }}</p>
        </div>

        <div class="form-group row">
          <label><i class="bx bx-envelope"></i> Email</label>
          <p class="readonly-text">{{ request.email }}</p>
        </div>

        <br />

        <!-- EVENT DETAILS SECTION -->
        <div class="section-title">Event Details</div>

        <!-- Event Image -->
        <div class="event-image-wrapper" *ngIf="request.image">
          <img [src]="request.image" alt="Event Image" class="event-photo" />
        </div>

        <div class="form-group row">
          <label><i class="bx bx-bolt-circle"></i> Event</label>
          <p class="readonly-text">{{ request.event }}</p>
        </div>

        <div class="form-group row">
          <label><i class="bx bx-first-aid"></i> Type</label>
          <p class="readonly-text">{{ request.eventType || request.event }}</p>
        </div>

        <div class="form-group row">
          <label><i class="bx bx-calendar"></i> Date Submitted</label>
          <p class="readonly-text">
            {{ request.timestamp?.toDate() | date: 'medium' }}
          </p>
        </div>
      </div>

      <!-- MIDDLE PANEL — MAP FIRST, LOCATION BELOW -->
      <div class="middle-panel">
        <h4 class="section-title">Location & Map</h4>

        <!-- MAP ABOVE -->
        <div class="map-box">
          <div
            #mapContainer
            class="map-container"
            style="width: 100%; height: 40vh"
          ></div>
        </div>

        <!-- LOCATION DETAILS BELOW -->
        <div class="location-info-box">
          <div class="form-group">
            <label><i class="bx bx-globe"></i> Country</label>
            <input type="text" value="Philippines" readonly />
          </div>

          <div class="form-group">
            <label><i class="bx bx-current-location"></i> Street Address</label>
            <input type="text" [value]="request.address || 'N/A'" readonly />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label><i class="bx bx-target-lock"></i> Latitude</label>
              <input type="text" [value]="request.latitude" readonly />
            </div>
            <div class="form-group">
              <label><i class="bx bx-target-lock"></i> Longitude</label>
              <input type="text" [value]="request.longitude" readonly />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label><i class="bx bx-map-pin"></i> Staff Latitude</label>
              <input type="text" [value]="request.staffLat || 'N/A'" readonly />
            </div>
            <div class="form-group">
              <label><i class="bx bx-map-pin"></i> Staff Longitude</label>
              <input type="text" [value]="request.staffLng || 'N/A'" readonly />
            </div>
          </div>

          <div class="form-group">
            <label><i class="bx bx-shield-plus"></i> Status</label>
            <input type="text" [value]="request.status" readonly />
          </div>

          <div class="form-group" *ngIf="currentUserRole === 'admin'">
            <label
              ><i class="bx bx-map-pin"></i> Your Current Location (Live)</label
            >
            <p class="readonly-text">{{ staffAddress }}</p>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL — DISPATCHED TEAM -->
      <div class="right-panel">
        <h4 class="section-title">Dispatched Team</h4>

        <!-- STAFF ASSIGNED -->
        <div class="rescue-card" *ngIf="request.staffEmail; else noAssigned">
          <p>
            <i class="bx bx-user"></i> {{ request.staffFirstName }} {{
            request.staffLastName }}
          </p>
          <p><i class="bx bx-envelope"></i> {{ request.staffEmail }}</p>
          <p><i class="bx bx-briefcase"></i> Mdrrmo Staff</p>

          <p class="dispatched-time">
            <i class="bx bx-time-five"></i>
            <strong>Dispatched At:</strong>
            {{ request.staffUpdatedAt?.toDate() | date: 'short' }}
          </p>
        </div>

        <!-- NO STAFF ASSIGNED -->
        <ng-template #noAssigned>
          <div class="no-assigned-box">
            <i class="bx bx-user-x"></i>
            <p>No staff assigned yet.</p>
          </div>
        </ng-template>

        <!-- SUBMIT STATUS → YOUR EXISTING CODE -->
        <div *ngIf="isSubmitting" class="submit-status submitting">
          <img src="../../../assets/resolve.gif" alt="" />
        </div>

        <div *ngIf="submitSuccess" class="submit-status success">
          <!-- your modal here -->
        </div>

        <div *ngIf="submitSuccessAccept" class="submit-status success">
          <!-- your modal here -->
        </div>
      </div>
    </div>

    <!-- LOADING STATE -->
    <div *ngIf="!request" class="loading-state">
      <p><i class="bx bx-loader-circle bx-spin"></i> Loading request data...</p>
    </div>
  </div>
</div>

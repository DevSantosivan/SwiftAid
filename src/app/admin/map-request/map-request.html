<div class="content-body">
  <div class="content_1">
    <h3>Emergency Request</h3>
    <p>Display all requests</p>
    <br />

    <!-- ===== TOP SECTION ===== -->
    <div class="request-top-section">
      <!-- Summary -->
      <div class="request-summary-grid">
        <div style="width: 100%; height: 400px; max-width: 400px; margin: auto">
          <p>Total Requests: {{ filteredRequests.length }}</p>
          <canvas #pieChartCanvas></canvas>
          <br />
        </div>
      </div>

      <!-- Map -->
      <div class="map-container">
        <h3>Map Request</h3>
        <p>View all requests when hovering list</p>
        <div id="requestMap"></div>
      </div>
    </div>

    <!-- ===== FILTER SECTION ===== -->
    <div class="request-table-container">
      <div class="header-controls">
        <label>Filter Status</label>
        <select [(ngModel)]="activeFilter" (change)="applyFilter(activeFilter)">
          <option value="All">All</option>
          <option value="Pending">Pending</option>
          <option value="Responding">In Progress</option>
          <option value="Resolved">Resolved</option>
        </select>

        <label>From:</label>
        <input
          type="date"
          [(ngModel)]="filterStartDate"
          (change)="onDateFilterChange()"
        />

        <label>To:</label>
        <input
          type="date"
          [(ngModel)]="filterEndDate"
          (change)="onDateFilterChange()"
        />
      </div>

      <!-- ===== LIST SECTION ===== -->
      <div class="request-list-container">
        <h4>All Emergency Request</h4>
        <p>List of emergency requests</p>
        @for (req of paginatedRequests; track $index) {
        <div
          class="request-card"
          [routerLink]="['/admin/EmergencyRequest', req.id]"
          [queryParams]="{ from: 'emergency' }"
          (mouseenter)="highlightMarker(req)"
        >
          <!-- Card Title -->
          <h4 class="request-title">
            {{ req.event }} - {{ req.status === "Responding" ? "In Progress" :
            req.status }}
          </h4>

          <div class="request-header">
            <div class="user-info">
              <img
                [src]="req.profilePicture || 'assets/profile-deafault.jpg'"
                alt="User"
              />
              <div class="user-details">
                <h5>{{ req.name }}</h5>
                <p><i class="bx bxs-phone"></i> {{ req.contactNumber }}</p>
              </div>
            </div>

            <span
              class="status-badge"
              [ngClass]="{
                pending: req.status === 'Pending',
                'in-progress': req.status === 'Responding',
                resolved: req.status === 'Resolved'
              }"
            >
              {{ req.status === "Responding" ? "In Progress" : req.status }}
            </span>
          </div>

          <div class="request-body">
            <p><i class="bx bxs-location-plus"></i> {{ req.address }}</p>
            <p>
              <i class="bx bx-time"></i> {{ req.timestamp | date: "mediumDate"
              }}
            </p>
          </div>

          <div class="request-footer">
            <button
              class="accept"
              (click)="$event.stopPropagation(); acceptRequest(req)"
              *ngIf="req.status === 'Pending'"
            >
              <i class="bx bxs-user-check"></i> Accept
            </button>
            <span
              class="view clickable"
              [routerLink]="['/admin/EmergencyRequest', req.id]"
              [queryParams]="{ from: 'emergency' }"
            >
              <i class="bx bx-show"></i> View
            </span>
          </div>
        </div>
        }
      </div>

      <!-- ===== PAGINATION ===== -->
      <div class="pagination-container">
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
        <div class="pagination-controls">
          <button (click)="goToPreviousPage()" [disabled]="currentPage === 1">
            ← Previous
          </button>
          <button
            (click)="goToNextPage()"
            [disabled]="currentPage === totalPages"
          >
            Next →
          </button>
        </div>
      </div>
    </div>

    <br /><br />
  </div>
</div>

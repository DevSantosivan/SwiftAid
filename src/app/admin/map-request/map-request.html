<div class="content-body">
  <div class="content_1">
    <h3>Emergency Request</h3>
    <p>Display all requests</p>
    <br />

    <!-- ===== TOP SECTION ===== -->
    <div class="request-top-section">
      <!-- Map -->
      <div class="map-container">
        <h3>Map Request</h3>
        <p>View all requests when hovering list</p>
        <div id="requestMap"></div>
      </div>
    </div>

    <!-- ===== LIST SECTION ===== -->
    <div class="request-list-container">
      <h4>All Emergency Request</h4>
      <p>List of emergency requests</p>

      <!-- ✅ SHOW THIS IF NO DATA -->
      <div
        class="no-data"
        *ngIf="filteredRequests.length === 0 && !isLoading; else hasData"
      >
        <img src="../../../assets/Empty Box.gif" alt="No Data" />
        <h4>No Emergency Requests Found</h4>
        <p>There are currently no pending or available requests.</p>
      </div>
      <br /><br />

      <!-- ✅ SHOW DATA IF AVAILABLE -->
      <ng-template #hasData>
        @for (req of paginatedRequests; track $index) {
        <div
          class="request-card"
          [routerLink]="['/admin/EmergencyRequest', req.id]"
          [queryParams]="{ from: 'emergency' }"
          (mouseenter)="highlightMarker(req)"
        >
          <!-- Card Title -->
          <h4 class="request-title">{{ req.event }}</h4>

          <div class="request-header">
            <div class="user-info">
              <img
                [src]="req.profilePicture || 'assets/profile-deafault.jpg'"
                alt="User"
              />
              <div class="user-details">
                <h5>{{ req.name }}</h5>
                <p><i class="bx bxs-phone"></i> {{ req.contactNumber }}</p>
              </div>
            </div>

            <span
              class="status-badge"
              [ngClass]="{
                pending: req.status === 'Pending',
                'in-progress': req.status === 'Responding',
                resolved: req.status === 'Resolved'
              }"
            >
              {{ req.status === "Responding" ? "In Progress" : req.status }}
            </span>
          </div>

          <div class="request-body">
            <p><i class="bx bxs-location-plus"></i> {{ req.address }}</p>
            <p>
              <i class="bx bx-time"></i>
              {{ req.timestamp | date: "mediumDate" }}
            </p>
          </div>

          <div class="request-footer">
            <button
              class="accept"
              (click)="$event.stopPropagation(); acceptRequest(req)"
              *ngIf="req.status === 'Pending'"
            >
              <i class="bx bxs-user-check"></i> Accept
            </button>
            <span
              class="view clickable"
              [routerLink]="['/admin/EmergencyRequest', req.id]"
              [queryParams]="{ from: 'emergency' }"
            >
              <i class="bx bx-show"></i> View
            </span>
          </div>
        </div>
        }
      </ng-template>
    </div>

    <!-- ===== PAGINATION ===== -->
    <div
      class="pagination-container"
      *ngIf="filteredRequests.length > 0 && !isLoading"
    >
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <div class="pagination-controls">
        <button (click)="goToPreviousPage()" [disabled]="currentPage === 1">
          ← Previous
        </button>
        <button
          (click)="goToNextPage()"
          [disabled]="currentPage === totalPages"
        >
          Next →
        </button>
      </div>
    </div>
  </div>

  <br /><br />
</div>
